name: "Archive Logs and Results"
description: "capture docker compose logs and test results"
inputs:
  reports:
    required: true
    type: string
runs:
  using: "composite"
  steps:
    - name: Dump Docker Compose Logs (gracefully)
      run: |
        LOGFILE=docker-compose.log
        : > "$LOGFILE"
        for c in $(docker ps --format '{{.Names}}'); do
          echo "==== Logs for $c ====" >> "$LOGFILE"
          if ! docker logs "$c" >> "$LOGFILE" 2>&1; then
            echo "[WARN] Could not retrieve logs for $c" >> "$LOGFILE"
          fi
          echo "" >> "$LOGFILE"
        done
      if: always()
      shell: bash
    - name: Archive docker-compose logs
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: docker-compose-logs
        path: "docker-compose.log"
    - name: Archive spec reports
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: rubocop-reports
        path: ${{ inputs.reports }}
